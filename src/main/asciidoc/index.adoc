= Package Manager

== Elenco completo dei packages

Questo servizio ritorna la lista di tutte le applicazioni con le loro rispettive versioni presenti sul server.
Risponde all'indirizzo

*_/api/v1/listPackages_*

.HTTP request
include::{snippets}/listAllPackages/http-request.adoc[]

.HTTP response
include::{snippets}/listAllPackages/http-response.adoc[]

.Elementi della HTTP response
include::{snippets}/listAllPackages/response-fields.adoc[]

=== Errori

Questo servizio non prevede particolari errori nella propria esecuzione.
Nel caso in cui non sia presente nessun package sul server, viene semplicemente ritornato un array vuoto.

.HTTP request
include::{snippets}/listAllPackagesEmpty/http-request.adoc[]

.HTTP response
include::{snippets}/listAllPackagesEmpty/http-response.adoc[]

== Elenco dei packages: ricerca per id

Questo servizio ritorna una lista di applicazioni, con le loro rispettive versioni, corrispondenti agli id ricercati e passati come parametri.
Risponde all'indirizzo

*_/api/v1/getPackages?idList={appIdList}_*

Gli id ricercati devono essere inviati come parametri della HTTP request e possono essere codificati in due diversi modi come documentato sotto.

.HTTP request - parametri separati con virgola
include::{snippets}/getPackagesByIdListParams/http-request.adoc[]

.HTTP request - elenco di parametri
include::{snippets}/getPackagesByIdRepeatedParamNames/http-request.adoc[]

.HTTP response
include::{snippets}/getPackagesByIdListParams/http-response.adoc[]

.Elementi della HTTP response
include::{snippets}/getPackagesByIdListParams/response-fields.adoc[]

=== Errori

==== Id non presenti

Nel caso in cui gli id ricercati non corrispondano a nessun package, o non vengano inviato alcun id, il servizio ritorna semplicemente un array vuoto

.HTTP request - id non trovato
include::{snippets}/getPackagesByIdEmpty/http-request.adoc[]

.HTTP request - id non inviato
include::{snippets}/getPackagesByIdEmptyParamList/http-request.adoc[]

.HTTP response
include::{snippets}/getPackagesByIdEmpty/http-response.adoc[]

==== Id non convertibili in valori interi

Nel caso in cui all'interno della lista dei parametri inviati siano presenti dei valori non convertibili in valori interi, vengono semplicemente ignorati

.HTTP request
include::{snippets}/getPackagesByIdMalformedURL/http-request.adoc[]

.HTTP response
include::{snippets}/getPackagesByIdMalformedURL/http-response.adoc[]

==== Malformed URL

Nel caso in cui nella HTTP request manchi completamente il nome dell'elenco di parametri, il srevizio risponde con una HTTP response vuota e HTTP status 400

.HTTP request
include::{snippets}/getPackagesByIdNoParams/http-request.adoc[]

.HTTP response
include::{snippets}/getPackagesByIdNoParams/http-response.adoc[]

== Elenco delle versioni di un'applicazione

Questo servizio ritorna la lista di tutte le versioni presenti sul server di una specifica applicazione.
Risponde all'indirizzo

*_/api/v1/listPackages/appName_*

dove appName è il nome dell'applicazione ricercata, corrispondente al campo ritornato da questo servizio

.HTTP request
include::{snippets}/listPackageVersions/http-request.adoc[]

.HTTP response
include::{snippets}/listPackageVersions/http-response.adoc[]

.Elementi della HTTP response
include::{snippets}/listPackageVersions/response-fields.adoc[]

=== Errori

==== Applicazione non presente

Nel caso in cui l'applicazione cercata non sia presente sul server, il servizio ritorna una risposta vuota con HTTP status 404.

.HTTP request
include::{snippets}/listNotFoundPackageVersions/http-request.adoc[]

.HTTP response
include::{snippets}/listNotFoundPackageVersions/http-response.adoc[]

== Informazioni di una specifica versione (per applicazione/versione)

Questo servizio ritorna tutte le informazioni relative a una singola versione di un'applicazione presente sul server.
Risponde all'indirizzo

*_/api/v1/listPackages/appName/appVersion_*

dove *_appVersion_* è l'intero identificante la specifica versione ricercata.

.HTTP request
include::{snippets}/listPackageVersionInfo/http-request.adoc[]

.HTTP response
include::{snippets}/listPackageVersionInfo/http-response.adoc[]

.Elementi della HTTP response
include::{snippets}/listPackageVersionInfo/response-fields.adoc[]

=== Errori

==== Applicazione/versione non presente

Nel caso in cui la combinazione applicazione/versione ricercata non sia presente sul server, il servizio risponde con una HTTP response vuota con HTTP status 404

.HTTP request
include::{snippets}/listNotfoundPackageVersionInfo/http-request.adoc[]

.HTTP response
include::{snippets}/listNotfoundPackageVersionInfo/http-response.adoc[]

== Informazioni di una specifica versione (per id)

Questo servizio, come il precedente, ritorna tutte le informazioni relative a una singola versione di un'applicazione presente sul server.
La differenza rispetto al precedente servizio risiede nel parametro di ricerca.
In questo caso, invece di usare la combinazione applicazione/versione, si usa l'id, identificativo univoco della specifica combinazione applicazione/versione ricercata.
Risponde all'indirizzo

*_/api/v1/getPackage/appId_*

dove *_appId_* è l'identificativo univoco della specifica combinazione applicazione/versione ricercata.

.HTTP request
include::{snippets}/getPackageById/http-request.adoc[]

.HTTP response
include::{snippets}/getPackageById/http-response.adoc[]

.Elementi della HTTP response
include::{snippets}/getPackageById/response-fields.adoc[]

=== Errori

==== Id non presente

Nel caso in cui l'id ricercato non sia presente sul server, il servizio risponde con una HTTP response vuota con HTTP status 404

.HTTP request
include::{snippets}/getPackageByIdNotFound/http-request.adoc[]

.HTTP response
include::{snippets}/getPackageByIdNotFound/http-response.adoc[]

==== Malformed URL

Nel caso in cui il parametro *_appID_* nell'indirizzo della request non sia del formato corretto (intero), il servizio risponde con una HTTP response vuota e HTTP status 400

.HTTP request
include::{snippets}/getPackageByIdMalformedURL/http-request.adoc[]

.HTTP response
include::{snippets}/getPackageByIdMalformedURL/http-response.adoc[]

== Invalidazione di un'applicazione

Questo servizio permette di rendere invalida una versione di un'applicazione presente sul server, settandone a false il flag _valid_.
Invalidando una versione di un'applicazione, essa non sarà piu disponibile per il download, pur continuando a essere presente sul server.
Per rendere di nuovo valida un'applicazione, sarà necessario effettuare un upload del file di questa versione tramite il servizio di upload descritto in seguito.
Risponde all'indirizzo

*_/api/v1/invalidatePackage/appName/appVersion_*

.HTTP request
include::{snippets}/invalidatePackage/http-request.adoc[]

.HTTP response
include::{snippets}/invalidatePackage/http-response.adoc[]

=== Errori

==== Applicazione/versione non presente

Nel caso in cui la combinazione applicazione/versione ricercata non sia presente sul server, il servizio risponde con una HTTP response vuota con HTTP status 404

.HTTP request
include::{snippets}/invalidateNotFoundPackage/http-request.adoc[]

.HTTP response
include::{snippets}/invalidateNotFoundPackage/http-response.adoc[]

== Download di un'applicazione

Questo servizio ritorna il file di una specifica versione di un'applicazione valida presente sul server. Nel caso in cui l'applicazione/versione sia marcata come non valida, questo servizio ritorna un errore (come specificato in seguito), ma il file sarà comunque disponibile attraverso il suo URL pubblico.
Il file compone il body della HTTP response del servizio, la response ha _Content-Type: application/octet_stream_.
Risponde all'indirizzo

*_/api/v1/downloadPackage/appName/appVersion_*

.HTTP request
include::{snippets}/downloadPackageFile/http-request.adoc[]

.HTTP response
include::{snippets}/downloadPackageFile/http-response.adoc[]

=== Errori

==== Applicazione/versione non presente

Nel caso in cui la combinazione applicazione/versione ricercata non sia presente sul server, il servizio risponde con una HTTP response vuota con HTTP status 404

.HTTP request
include::{snippets}/downloadNotFoundPackageFile/http-request.adoc[]

.HTTP response
include::{snippets}/downloadNotFoundPackageFile/http-response.adoc[]

==== Package non valido

Nel caso in cui la versione dell'applicazione richiesta sia invalida, ovvero il flag _valid_ sia settato a false, non è possibile scaricare il corrispondente file e il servizio risponde con una HTTP response vuota e HTTP status 403

.HTTP request
include::{snippets}/downloadPackageInvalidFile/http-request.adoc[]

.HTTP response
include::{snippets}/downloadPackageInvalidFile/http-response.adoc[]

==== File illeggibile

Nel caso in cui l'applicazione richiesta sia presente sul server ma si verifichi un errore di lettura del suddetto file, il servizio risponde con una HTTP response vuota e HTTP status 500

.HTTP request
include::{snippets}/downloadPackageUnreadableFile/http-request.adoc[]

.HTTP response
include::{snippets}/downloadPackageUnreadableFile/http-response.adoc[]

== Upload di un'applicazione

Questo servizio registra sul server un file di un'applicazione.
Risponde all'indirizzo

*_/api/v1/uploadPackage/packageName/appName/appVersion/fileName_*

_packageName_, _appName_ e _appVersion_ sono coerenti con quanto specificato in precedenza, mentre _fileName_ sarà oltre che al rispettivo campo delle informazioni della versione dell'applicazione installata, anche il nome del file registrato sul server.
Il body della HTTP request conterrà il file che si vuole registrare sul server, e come _Content-Type: application/octet-stream_

.HTTP request
include::{snippets}/uploadPackage/http-request.adoc[]

.HTTP response
include::{snippets}/uploadPackage/http-response.adoc[]

=== Errori

==== Errore di scrittura del file

Nel caso in cui si verifichi un errore di scrittura del file che si vuole caricare, il servizio risponde con una HTTP response vuota e HTTP status 500

.HTTP request
include::{snippets}/uploadNotWritablePackage/http-request.adoc[]

.HTTP response
include::{snippets}/uploadNotWritablePackage/http-response.adoc[]